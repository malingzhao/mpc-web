# Ed25519 BIP32 + MPC 演示文档

## 概述

本演示展示了如何将Ed25519椭圆曲线密码学、BIP32分层确定性密钥派生和多方安全计算(MPC)技术结合使用，创建一个安全、可扩展的密钥管理和签名系统。

## 技术背景

### Ed25519
- **高性能**: Ed25519是一种高性能的椭圆曲线数字签名算法
- **安全性**: 基于Curve25519椭圆曲线，提供128位安全级别
- **确定性**: 签名过程是确定性的，相同消息产生相同签名
- **抗侧信道攻击**: 设计上抵抗时序攻击和其他侧信道攻击

### BIP32 (分层确定性密钥派生)
- **确定性**: 从单个种子可以确定性地派生出无限数量的密钥
- **分层结构**: 支持树状密钥结构，便于组织和管理
- **隐私保护**: 子密钥之间相互独立，不会泄露其他密钥信息
- **备份友好**: 只需备份主种子即可恢复所有派生密钥

### MPC (多方安全计算)
- **分布式安全**: 密钥分片存储在多个节点，无单点故障
- **隐私保护**: 计算过程中不泄露私钥信息
- **门限签名**: 支持t-of-n门限方案，提高系统可用性
- **抗合谋**: 即使部分节点被攻破也不会泄露完整密钥

## 演示程序说明

### 1. 基础演示 (`ed25519_bip32_mpc_demo.go`)

这是一个完整的Go语言演示程序，展示了Ed25519 BIP32 + MPC的核心功能：

#### 主要功能
1. **MPC分布式密钥生成**: 使用3方DKG协议生成Ed25519密钥
2. **BIP32主密钥创建**: 将MPC生成的密钥转换为BIP32兼容格式
3. **密钥派生演示**: 展示多种派生路径的密钥生成
4. **MPC签名**: 使用派生密钥进行分布式签名
5. **多路径密钥管理**: 演示不同用途的密钥管理策略

#### 运行方式
```bash
cd /Users/malltony/mpc/threshold-lib
go run ed25519_bip32_mpc_demo.go
```

#### 输出示例
```
=== Ed25519 BIP32 + MPC 完整演示 ===
🔑 步骤1: Ed25519 MPC分布式密钥生成
✅ MPC DKG完成
  参与者1: ID=1, 密钥份额=...
  参与者2: ID=2, 密钥份额=...
  参与者3: ID=3, 密钥份额=...

🌳 步骤2: 创建Ed25519 BIP32主密钥
✅ 主TSS密钥创建成功

📈 步骤3: Ed25519 BIP32密钥派生演示
  路径m/0: 公钥一致性=✅
  路径m/0/1: 公钥一致性=✅
  ...

✍️  步骤4: 使用派生密钥进行MPC签名
  签名验证: ✅ 有效

🗂️  步骤5: 多路径密钥管理演示
  不同用途的密钥派生:
    用户账户1 (m/0/0): ✅ 密钥一致
    企业钱包 (m/1/0): ✅ 密钥一致
    ...
```

### 2. 服务器演示 (`ed25519_bip32_mpc_demo.py`)

这是一个Python脚本，展示了如何在实际的MPC服务器环境中使用Ed25519 BIP32：

#### 主要功能
1. **服务器状态检查**: 验证MPC服务器是否正常运行
2. **密钥管理器**: 封装了密钥生成和派生的逻辑
3. **用途导向的密钥派生**: 为不同业务用途创建专用密钥
4. **签名管理**: 使用派生密钥进行业务签名
5. **最佳实践指导**: 提供实际部署的建议

#### 运行方式
```bash
cd /Users/malltony/mpc/threshold-lib/mpc-server
python3 ed25519_bip32_mpc_demo.py
```

#### 前置条件
确保MPC服务器正在运行：
```bash
cd mpc-server
./scripts/start_all.sh
```

## 技术实现细节

### 1. Ed25519 TSS密钥结构

```go
type Ed25519TssKey struct {
    shareI       *big.Int        // 密钥份额
    publicKey    *curves.ECPoint // 公钥
    chaincode    []byte          // 链码
    offsetSonPri *big.Int        // 累积偏移量
}
```

### 2. BIP32派生算法

Ed25519的BIP32派生使用特殊的HMAC-SHA512算法：

```
HMAC-SHA512(ed25519Label | chaincode | publicKey | childIdx)
```

其中：
- `ed25519Label`: "Ed25519 key share derivation:\n"
- `chaincode`: 32字节链码
- `publicKey`: 父公钥
- `childIdx`: 子密钥索引

### 3. MPC签名流程

1. **密钥调整**: 原始密钥份额 + BIP32派生偏移量
2. **签名协议**: 执行Ed25519的3轮MPC签名协议
3. **签名合并**: 将各方的签名份额合并为最终签名
4. **验证**: 使用派生的公钥验证签名

### 4. 安全考虑

#### 密钥安全
- 主密钥通过MPC DKG生成，无单点故障
- 派生密钥继承MPC的安全属性
- 支持门限签名，提高系统可用性

#### 隐私保护
- 派生过程不泄露主密钥信息
- 子密钥之间相互独立
- MPC计算过程保护私钥隐私

#### 抗攻击能力
- 抵抗侧信道攻击
- 防止密钥泄露
- 支持密钥轮换

## 应用场景

### 1. 企业级钱包
- **多部门管理**: 为不同部门派生独立密钥
- **权限控制**: 基于业务需求设置签名门限
- **审计追踪**: 记录所有密钥派生和签名操作

### 2. DeFi协议
- **多策略管理**: 为不同投资策略派生专用密钥
- **风险隔离**: 将高风险和低风险操作分离
- **自动化签名**: 支持智能合约的自动化交互

### 3. 托管服务
- **客户隔离**: 为每个客户派生独立的密钥树
- **合规要求**: 满足监管对密钥管理的要求
- **灾难恢复**: 基于主种子快速恢复所有客户密钥

### 4. 跨链桥
- **多链支持**: 为不同区块链派生专用密钥
- **资产隔离**: 将不同类型的资产分别管理
- **安全转账**: 使用MPC确保跨链转账安全

## 性能优化

### 1. 密钥缓存
- 预先派生常用路径的密钥
- 缓存派生结果，避免重复计算
- 实现LRU缓存策略

### 2. 批量操作
- 批量派生多个子密钥
- 批量执行签名操作
- 并行处理独立的密钥操作

### 3. 网络优化
- 优化MPC协议的通信轮次
- 使用高效的序列化格式
- 实现连接池和重用

## 部署建议

### 1. 硬件要求
- **CPU**: 支持AES-NI指令集
- **内存**: 至少4GB RAM
- **存储**: SSD存储，确保快速I/O
- **网络**: 低延迟网络连接

### 2. 安全配置
- **网络隔离**: 使用VPN或专用网络
- **访问控制**: 实现严格的身份认证
- **监控告警**: 部署实时监控系统
- **备份策略**: 定期备份关键数据

### 3. 高可用性
- **多地部署**: 跨地域部署MPC节点
- **故障转移**: 实现自动故障检测和转移
- **负载均衡**: 分散签名请求负载
- **健康检查**: 定期检查节点健康状态

## 总结

Ed25519 BIP32 + MPC的结合为现代密码学应用提供了一个强大的解决方案：

1. **安全性**: 结合了三种技术的安全优势
2. **可扩展性**: 支持大规模密钥管理
3. **灵活性**: 适应各种业务场景
4. **实用性**: 提供完整的实现和演示

这个演示为开发者提供了一个完整的参考实现，可以作为构建生产级密钥管理系统的基础。